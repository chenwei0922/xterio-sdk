import{K as ne}from"./chunk-PKCUTZ46-D4jjun5b.js";import{z as ae}from"./loginAccount-E66JXWKK-CxBeO3MP.js";import{N as ie}from"./chunk-BOXSB6AN-_JWADXst.js";import{p as R}from"./chunk-3WXPHVZ4-C7rXuFaZ.js";import{N as ce}from"./chunk-6X7TBCV3-BN1PXSNv.js";import{J as se,af as le,s as de,r as c,v as ue,L as pe,A as m,z as me,a as ge,ag as ve,o,P as he,S as ye,t as L,ae as fe,ah as xe,ai as be,aj as _e,N as P,ak as we,D as g,X as Ce}from"./index-Bn-ps2Oq.js";import{u as ke}from"./index-CrhXbJwi.js";import{u as f}from"./useRequest-g7Hc95KC.js";import{B as Ee}from"./throttle-C-YdzAkS.js";import{u as Ne}from"./useTranslation-B27UQaAP.js";import"./chunk-IBLFF4W2-CPpBOu4k.js";import"./index-SMmWVYvk.js";import"./debounce-CMz2Qhby.js";import"./isObject-CrIk3fyR.js";var Te=`.set-viery-container {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  overflow: auto;
  color: var(--text-color);
}
.set-viery-container .footer-box {
  position: absolute;
  bottom: 10px;
  margin: 0;
}
@media only screen and (max-height: 520px) {
  .set-viery-container .footer-box {
    position: unset;
    bottom: 0;
    margin-top: 20px;
    margin-bottom: 10px;
  }
}
.set-viery-container .display-none {
  display: none;
}
.set-viery-container .error-tip {
  width: 90%;
  height: 0;
  padding-left: 10px;
  margin-top: 6px;
  margin-bottom: 0;
  text-align: left;
  color: red;
  opacity: 0;
  transition: all 0.3s;
}
.set-viery-container .error-tip.show {
  height: 30px;
  opacity: 1;
}
.set-viery-container .set-email-title {
  margin-top: 60px;
  font-size: 22px;
  color: var(--text-color);
}
.set-viery-container .patment-tips1 {
  width: 80vw;
  margin-top: 30px;
  font-size: 14px;
  text-align: center;
  color: var(--text-color);
}
@media (min-width: 600px) {
  .set-viery-container .patment-tips1 {
    width: calc(80 * var(--vw));
  }
}
.set-viery-container .set-email-buttons {
  position: absolute;
  bottom: 0;
  left: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
  width: 100%;
  height: auto;
  padding-bottom: 20px;
}
.set-viery-container .success-icon {
  width: 50px;
  height: 50px;
  margin-top: 60px;
}
.set-viery-container .set-email-desc-1 {
  box-sizing: border-box;
  padding: 0 18px;
  margin: 15px 0 25px;
  font-weight: 400;
  font-size: 14px;
  line-height: 16px;
  text-align: center;
  color: var(--text-color);
}
.set-viery-container .account-submit-btn {
  width: 90%;
  height: 47px;
  padding: 0;
  margin-top: 38px;
  border: none;
  border-radius: var(--primary-btn-border-radius);
  font-weight: 500;
  font-size: var(--primary-btn-font-size);
  line-height: 47px;
  text-align: center;
  color: var(--primary-btn-color);
  background: var(--primary-btn-background-color);
  opacity: 1;
}
.set-viery-container .account-submit-btn:hover {
  border: none;
  color: var(--primary-btn-color) !important;
  background: var(--primary-btn-background-color) !important;
  opacity: var(--hover-opacity);
}
.set-viery-container .account-switch-item {
  margin-top: 40px;
  font-weight: 500;
  font-size: 13px;
  line-height: 19px;
  color: var(--accent-color);
  cursor: pointer;
}
.set-viery-container .set-email-desc-2 {
  min-width: 116px;
  height: 23px;
  padding: 0 15px;
  margin: 20px 0 28px;
  border-radius: var(--primary-btn-border-radius);
  font-weight: 400;
  font-size: 12px;
  line-height: 23px;
  text-align: center;
  color: var(--secondary-text-color);
  background: var(--tag-background-color);
  opacity: 1;
}
.set-viery-container .back {
  display: flex;
  align-items: center;
  margin-top: 90px;
  font-weight: 400;
  font-size: 16px;
  line-height: 19px;
  color: var(--accent-color);
  opacity: 1;
  cursor: pointer;
  gap: 8px;
}
.set-viery-container .back svg {
  position: relative;
  top: -1px;
  color: var(--accent-color);
}
.set-viery-container .code-error {
  position: absolute;
  left: calc((100vw - 316px) / 2);
  margin-top: 224px;
  font-weight: 400;
  font-size: 12px;
  color: var(--error-color);
}
@media (min-width: 600px) {
  .set-viery-container .code-error {
    left: calc((var(--vw) * 100 - 316px) / 2);
  }
}
.set-viery-container .send-again {
  margin-top: 20px;
  border: none !important;
  outline: none !important;
  font-weight: 400;
  font-size: 16px;
  line-height: 19px;
  color: var(--text-color);
  background-color: transparent;
  box-shadow: none;
}
.set-viery-container .send-again:hover {
  color: var(--text-color) !important;
  background-color: transparent !important;
}
.set-viery-container .send-again:disabled {
  opacity: 0.5;
}
`,Se=$=>{let l=se(),{t}=Ne(),J=$,x=ie(),{customRouter:D}=le(),{themeType:O,language:U}=de(),{account:s,pageType:u,authType:i,verifyToken:j,redirectUrl:X,password:Y}=J,[b,q]=c.useState(""),[N,_]=c.useState(1e3),[v,w]=c.useState(60),[C,d]=c.useState(),{authCoreModal:T}=ue(),{userInfo:F}=pe(),[K,S]=c.useState(!1),z=c.useRef(null);ke(()=>{if(v>0){let e=v-1;w(e),e===0&&_(void 0)}},N);let{run:A}=f(async e=>u==="bind_login_account"?(e={[i]:s,cf_turnstile_response:e.cf_turnstile_response},fe(e).then(n=>n)):xe(e.verifyCodeMethod),{manual:!0,onSuccess:(e,n)=>{N||(w(60),_(1e3))},onError:e=>{w(0),_(void 0)}}),{runAsync:M}=f(be,{manual:!0,onBefore:()=>{S(!0)},onError:e=>{(e==null?void 0:e.error_code)===g.InvalidCode?d(t("login.invalid_code")):(e==null?void 0:e.error_code)===g.ResendCode?d(t("login.please_send_again")):e.message&&x.error(e.message)},onFinally:()=>{setTimeout(()=>{S(!1)},2e3)}}),{loading:Z,runAsync:G}=f(async e=>_e(e).then(async()=>{await P()}),{manual:!0,onSuccess:e=>{x.success(t("new.bind_login_account_success"))},onError:e=>{var n;let r=e.message;if((e==null?void 0:e.error_code)===g.InvalidCode){d(t("login.invalid_code"));return}else if((e==null?void 0:e.error_code)===g.ResendCode){d(t("login.please_send_again"));return}else e.error_code===20109?r=i==m.email?t("error.server_email_20109"):t("error.server_phone_20109"):r=((n=e==null?void 0:e.extra)==null?void 0:n[0])||e.message;Ce.error({title:r,wrapClassName:"auth-core-modal-error",getContainer:()=>T.rootBody,onOk:()=>{var a;(a=z.current)==null||a.clear(),e.error_code===20109&&l(-1)}})}}),{loading:H,run:Q}=f(we,{manual:!0,onError:e=>{(e==null?void 0:e.error_code)===g.InvalidCode?d(t("login.invalid_code")):(e==null?void 0:e.error_code)===g.ResendCode&&d(t("login.please_send_again"))},onSuccess:(e,n)=>{P();let r=["account/security","solana/sign","evm-chain/sign"],a=r.map(E=>{var p;return(p=D.history)==null?void 0:p.findIndex(y=>y.path===E)}),k=a.indexOf(Math.max(...a));l(r[k],{replace:!0,back:!0})}}),{loading:V}=f(()=>new Promise((e,n)=>{}),{manual:!0,onSuccess:e=>{}}),h=c.useMemo(()=>s!=null&&s.includes("@")?m.email:m.phone,[s]);c.useEffect(()=>{B()},[s]);let B=()=>{d(""),u==="bind_login_account"&&i===m.phone?me({theme:O,language:U,getContainer:()=>T.rootBody}).then(e=>{A({verify_code_method:h,cf_turnstile_response:e})}).catch(()=>{x.error(t("error.server_20112")),l(-1)}):A({verifyCodeMethod:h})},W=e=>{d(""),q(e),e.length===6&&ee(e)},ee=c.useCallback(Ee(e=>{I(e)},1e3,{leading:!0,trailing:!1}),[]),te=e=>{Q({password:Y,verifyCodeMethod:h,code:e||b})},I=(e="")=>{if(C)return;let n={code:e};u==="reset_payment_password"?te(e):u=="verify_security_account_set_security_account"?M({verifyCodeMethod:h,code:e}).then(r=>{l("/account/bind",{replace:!0,state:{accountType:i,verifyToken:r,redirectUrl:X}})}):u==="verify_security_account_bind_login_account"?M({verifyCodeMethod:h,code:e}).then(r=>{let a=ae({userInfo:F,t}),{id:k,value:E}=a.find(p=>p.type===i)||{};if(i===m.phone||i===m.email||E||k)l("/login-account/bind",{state:{authType:i,verifyToken:r},replace:!0});else{let p=ge.encode(JSON.stringify({verifyToken:r,purpose:"bindLoginAccount"}));ve({authType:i,appState:p,prompt:"select_account"}).catch(y=>{x.error((y==null?void 0:y.message)||y)})}}):u==="bind_login_account"&&(n={...n,security_account_verify_token:j,[i]:s},G(n).then(r=>{l(-2)}))},re=()=>s.includes("@")?he(s):ye(s);c.useEffect(()=>{var e;let n=document.getElementsByClassName("react-input-code"),r=a=>a.preventDefault();return(e=n[0])==null||e.addEventListener("contextmenu",r),()=>{var a;(a=n[0])==null||a.removeEventListener("contextmenu",r)}},[]);let oe=()=>{var e;(e=document.getElementsByClassName("input-code-item")[Math.min(b.length,5)])==null||e.focus()};return o.createElement("div",{className:"set-viery-container"},o.createElement("style",null,Te),o.createElement("div",{className:"account-header"},o.createElement(R,{className:"icon-navigation-back",name:"circle_back",onClick:()=>{l(-1)}})),o.createElement("h2",{className:"set-email-title"},t("account.enter_code")),o.createElement("p",{className:"set-email-desc-2"},re()),o.createElement("div",{onClick:oe},o.createElement(ne,{containerClassName:"react-input-code",inputClassName:"input-code-item",allowedCharacters:"numeric",length:6,ref:z,placeholder:" ",onChange:W})),C&&o.createElement("div",{className:"code-error"},C),o.createElement(L,{className:"account-submit-btn",loading:H||K||Z||V,onClick:()=>{setTimeout(()=>{I(b)})},disabled:b.length!==6},t("common.confirm")),o.createElement(L,{className:"send-again",onClick:B,disabled:v>0},v>0?`${t("login.send_again")} (${v}s)`:t("login.send_again")),o.createElement("div",{className:"back",onClick:()=>{l(-1)}},o.createElement(R,{className:"arrow1-icon",name:"arrow1_icon"}),o.createElement("span",null,t("login.back"))),o.createElement(ce,null))},Xe=Se;export{Xe as default};
